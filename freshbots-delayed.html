<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bot</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,user-scalable=no,height=device-height,maximum-scale=1"
    />
    <style type="text/css">
      html {
        height: 100%;
      }
      body {
        min-height: 100%;
        margin: 0;
        background: #f2f2f2;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol";
      }
    </style>
    <style>
      .chat-container .chat-head {
        border-radius: 0;
      }
    </style>
  </head>
  <body>
    <!-- Delayed INIT chat -->
    <script>
      var orderData = {
        xtrnlTcktId: "",
        "sn::cstmr::id": "",
        device_id: "",
      };

      function hideFreshbotsWidget() {
        console.log("Closing freshbots widget and go back...");

        Freshbots.hideWidget();
        history.back();
      }

      function showFreshbotsWidget(orderId, orderName, deviceId) {
        console.log("Opening order #" + orderId + " " + orderName + "...");

        // Update order details in the orderData object reference
        orderData.xtrnlTcktId = userId + orderId;
        orderData["sn::cstmr::id"] = userId;
        orderData.device_id = deviceId;

        Freshbots.initiateChat();
        Freshbots.showWidget(true);
      }
    </script>

    <!-- Freshbots script -->
    <script>
      (function (d, w, c) {
        var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script");
        var loaded = false;

        s.id = "spd-busns-spt";
        s.async = "async";
        s.setAttribute("data-self-init", "false");
        s.setAttribute("data-init-type", "delayed");

        s.src = "https://cdn.freshbots.ai/assets/share/js/freshbots.js";

        s.setAttribute("data-client", "JOE");
        s.setAttribute(
          "data-bot-hash",
          "27d18eea2d5709011fe5bc04cdbe1007917ed644"
        );
        s.setAttribute("data-bot-version", "10");
        s.setAttribute("data-flow-hash", "");
        s.setAttribute("data-region", "us");
        s.setAttribute("data-env", "stag");
        // s.setAttribute("data-spa-app", "true");

        if (c) {
          s.onreadystatechange = s.onload = function () {
            if (!loaded) {
              c();
            }
            loaded = true;
          };
        }

        n.parentNode.insertBefore(s, n);
      })(document, window, function () {
        Freshbots.initiateWidget(
          {
            autoInitChat: false,
            getClientParams: function () {
              return orderData;
            },
            getDialer: function () {
              console.log("====> Get Dialer log from index.html", arguments[0]);

              return true;
            },
            navigateToDeeplink: function () {
              console.log(
                "====> Navigate to deeplink log from index.html",
                arguments[0]
              );
              const params = arguments[0];

              window.open(params.deeplink, "_blank").focus(); // for example opening it in new tab
            }
          },
          function (successResponse) {},
          function (errorResponse) {}
        );
      });
    </script>
  </body>
</html>
