<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bot</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,user-scalable=no,height=device-height,maximum-scale=1"
    />
    <style type="text/css">
      html {
        height: 100%;
      }
      body {
        min-height: 100%;
        margin: 0;
        background: #f2f2f2;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
          "Segoe UI Symbol";
      }
    </style>
    <style>
      .chat-container .chat-head {
        border-radius: 0;
      }
    </style>
  </head>
  <body>
    <!-- Delayed INIT chat -->
    <script>
      var orderData = {
        xtrnlTcktId: "",
        "sn::cstmr::id": "",
        device_id: "",
      };

      function hideFreshbotsWidget() {
        console.log("Closing freshbots widget and go back...");

        Freshbots.hideWidget();
        history.back();
      }

      function showFreshbotsWidget(userId, orderId, deviceId) {
        console.log("Opening user #" + userId + " order #" + orderId + " ...");

        // Update order details in the orderData object reference
        orderData.xtrnlTcktId = userId + orderId;
        orderData["sn::cstmr::id"] = userId;
        orderData.device_id = deviceId;

        Freshbots.initiateChat();
        Freshbots.showWidget(true);
      }

      function notifyWidgetLoadedStatus(status) {
        var postMessageData = JSON.stringify({ widgetLoaded: status });

        window.ReactNativeWebView &&
          window.ReactNativeWebView.postMessage(postMessageData);
      }
    </script>

    <!-- Freshbots script -->
    <script>
      (function (d, w, c) {
        var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script");
        var loaded = false;

        s.id = "spd-busns-spt";
        s.async = "async";
        s.setAttribute("data-self-init", "false");
        s.setAttribute("data-init-type", "delayed");

        s.src = "https://cdn.in-freshbots.ai/assets/share/js/freshbots.min.js";

        s.setAttribute("data-client", "5bcaeb559a88f6c406a65031a7b1e1abf2316df0");
        s.setAttribute(
          "data-bot-hash",
          "ce6ef7fa7e5644503050d7b4b0a97eb68033edef"
        );
        s.setAttribute("data-region", "in");
        s.setAttribute("data-env", "prod");

        if (c) {
          s.onreadystatechange = s.onload = function () {
            if (!loaded) {
              c();
            }
            loaded = true;
          };
        }

        n.parentNode.insertBefore(s, n);
      })(document, window, function () {
        Freshbots.initiateWidget(
          {
            autoInitChat: false,
            getClientParams: function () {
              return orderData;
            }
          },
          function (successResponse) {
            notifyWidgetLoadedStatus(true);
          },
          function (errorResponse) {
            notifyWidgetLoadedStatus(false);
          }
        );
      });
    </script>
  </body>
</html>
